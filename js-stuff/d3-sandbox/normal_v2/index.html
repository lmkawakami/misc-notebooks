<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

  <link rel="stylesheet" href="style.css" />
  <script src="https://d3js.org/d3.v6.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.5.0/lodash.min.js"></script>
  <svg height="10" width="10" xmlns="http://www.w3.org/2000/svg" version="1.1">
    <defs>
      <pattern id="orange-c" patternUnits="userSpaceOnUse" width="10" height="10">
        <image
          xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAH1JREFUOE+t1EsOwCAIBFC4s8fonW1oKkFLlZ8bjcpLZjPYL+jwLmyA42zd5TzN4LiowBiswh7QGk3+W2PKNze4xRqgCzxhrsgWzAxaMRPowY6gF9uCEewXjGIqmME+YBabwAqMwSpsqi+tJCItxH24ghGMkqpgFFMjZzACbzdTSturajLDAAAAAElFTkSuQmCC"
          x="0"
          y="0"
          width="10"
          height="10"
        ></image>
      </pattern>

      <pattern id="orange-c2" patternUnits="userSpaceOnUse" width="12" height="12">
        <image
          xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAAAXNSR0IArs4c6QAAAJZJREFUSEu11t0OwBAMBWB9Z4+xd7ZYRrCO/py6IRX9knOjVK5U0rsoJ2pn7z72rb2oFSKRDkUjD+SNaHy/xjXewaAtkhNBoBMCiU6CuCEp4oI0iBnSIibIgqghK6KCPIgY8iIiCIEcIRSyhZDIL4RGWCgC+UBRyARFIh2KRqbhhPvSkbNEn4JWCInUxFgIjbDRRSAVugGIvFzh603qCwAAAABJRU5ErkJggg=="
          x="0"
          y="0"
          width="12"
          height="12"
        ></image>
      </pattern>

      <pattern id="green-c" patternUnits="userSpaceOnUse" width="10" height="10">
        <image
          xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAIVJREFUOE+t1NsNgCAMBVC7kOs4iVM4ieuwkKZGmoIV+uIHAvQk9+fCemzX8q6yn1DP2p3P4wzUiwyMwCzsAbXR+L8+Jn8zgyMMk5rAGWaKrMHUoBZTgRZsClqxIejBfkEvJoIR7ANGsQbMwAjMwpr6kkrC00LUhz3owTCpCHoxMXIEQ/AG7yhaftVUrtsAAAAASUVORK5CYII="
          x="0"
          y="0"
          width="10"
          height="10"
        ></image>
      </pattern>

      <pattern id="green-c2" patternUnits="userSpaceOnUse" width="12" height="12">
        <image
          xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAAAXNSR0IArs4c6QAAAJtJREFUSEu11tsNgCAMBVBZyHWcxCmcxHVcSCOJBJBHH/fyBT+cpKWlYT22e8nWtZ8hP3v2+d2hht6LGVgTYmBdCI3FfLTC9+UGFcaUeDZWvDAm9nvKLKxZMwysW5xobNgFkNi03aCwKYSqMxGEwMSQF1NBHkwNWTETZMHMkBZzQRrMDUkxCCTBYNAMizMD6rseYWk4YWPFFMTEHloFcoR9SeWRAAAAAElFTkSuQmCC"
          x="0"
          y="0"
          width="12"
          height="12"
        ></image>
      </pattern>

    </defs>
  </svg>
</head>
<body>
  <div id='plots-container'>
    <div id="normal_dist_div"><h2>Population Distribution</h2></div>
    <div id="confusion_matrix_div"><h2>Confusion Matrix</h2></div>
    <div id="roc_div"><h2>Roc</h2></div>
    <div id="bayesian_separator"><h1>Bayesian views:</h1></div>
    <div id="full_tree_map_div"><h2>Whole population</h2></div>
    <div id="sick_tree_map_div"><h2>Sick individuals</h2></div>
    <div id="healthy_tree_map_div"><h2>Healthy individuals</h2></div>
    <div id="positive_tree_map_div"><h2>Positive tests</h2></div>
    <div id="negative_tree_map_div"><h2>Negative tests</h2></div>
  </div>
  <div id='inputs_and_coefs_div'>
    <div id='inputs-container'>
      <strong>Inputs:</strong> <br>
      <span>
        <span class="input-span">Healthy μ : <input type="number" step=".5" id="healthy_mu" onchange="globals.setHealthyMu(event)"></span>
        <span class="input-span">Sick μ : <input type="number" step=".5" id="sick_mu" onchange="globals.setSickMu(event)"></span>
        <span class="input-span">Threshold : <input type="number" step=".1" id="threshold" onchange="globals.setThreshold(event)"></span>
      </span>
      <br>
      <span>
        <span class="input-span">Healthy σ : <input type="number" step=".1" id="healthy_sigma" onchange="globals.setHealthySigma(event)"></span>
        <span class="input-span">Sick σ : <input type="number" step=".1" id="sick_sigma" onchange="globals.setSickSigma(event)"></span>
        <span class="input-span">Balance&nbsp&nbsp : <input type="number" step=".05" id="balance" onchange="globals.setBalance(event)"></span>
      </span>
    </div>
    <div id='coefs-container'>
      <table>
        <tr>
          <!-- <th class='coefs' title="True Positives = TP/(TP+FP+TN+FN)">TP</th>
          <th class='coefs' title="True Negatives = TN/(TP+FP+TN+FN)">TN</th>
          <th class='coefs' title="False Positives = FP/(TP+FP+TN+FN)">FP</th>
          <th class='coefs' title="False Negatives = FN/(TP+FP+TN+FN)">FN</th> -->
          
          <th class='coefs' title="Accuracy = (TP + TN)/(TP+FP+TN+FN)">accuracy</th>
          <th class='coefs' title="True positive rate = TP/(TP+FN)">TPR / recall<br> sensitivity</th>
          <th class='coefs' title="False positive rate = FP/(FP+TN)">FPR</th>
          <th class='coefs' title="Positive predictive value = TP/(TP+FP)">PPV <br> precision</th>
          <th class='coefs' title="True negative rate = TN/(TN+FP)">TNR <br> specificity </th>
          <th class='coefs' title="Balanced Accuracy = (TPR + TNR)/2">balanced <br> accuracy</th>
        </tr>
        <tr>
          <!-- <td class='coefs' id="td-TP"></td>
          <td class='coefs' id="td-TN"></td>
          <td class='coefs' id="td-FP"></td>
          <td class='coefs' id="td-FN"></td> -->
          
          <td class='coefs' id="td-ACC"></td>
          <td class='coefs' id="td-TPR"></td>
          <td class='coefs' id="td-FPR"></td>
          <td class='coefs' id="td-PPV"></td>
          <td class='coefs' id="td-TNR"></td>
          <td class='coefs' id="td-BACC"></td>
        </tr>
      </table>
    </div>
  </div>
  <hr>
  <h1>Visualization of Disease Testing Statistics:</h1>
  <p>This interactive page ilustrates a fraction of the complexyty of disease testing and some of it's tradeoffs, focusing on the statistical/probabilistal side.</p>
  <p>It's a simplification, just a toy model with some knobs, made by an electrical engineer without any serious medical knolege. Take any conclusion with a grain of salt.</p>
  <p>To illustrate a real situation data from a published paper was used, showing how two different tests can differ. Clicking on the "apply" buttons below you can simulate the conditions reported on the journal and see the difference between the two kinds of test and what happen when some parameters are changed. There is a <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0248921">link to the article HERE</a> and on the botton of this page.</p>

  <!-- <h1>Visualização Estatística de Testes para Doenças</h1>
  <p>Esta página interativa ilustra uma fração da complexidade dos testes de doenças e algumas das relações custo/benefício, focando mais nos aspectos estatísticos/probabilísticos.</p>
  <p>É uma simplificação, apenas um modelo com alguns controles que foi construído por um engenheiro elétricista sem domínio de conhecimentos médidos.</p>
  <p>Para ilustrar uma situação real, peguei os dados de uma públicação científica que explorava os dados de 2 tipos diferentes de testes para COVID e tentei replicar o comportamento no modelo. Basta clicar em um dos botões para que todos os controles sejam ajustados para os respectivos valores adequados.</p> -->
  <table id="demo_table">
    <tr>
      <th class="demo_table">
        <h3>Statistic</h3>
      </th>
      <th class="demo_table">
        <h3>Standard Q <button onclick="applyStandardQCoefs()">apply</button></h3>
      </th>
      <th class="demo_table">
        <h3>Panbio <button onclick="applyPanbioCoefs()">apply</button></h3>
      </th>
    </tr>
    <tr>
      <td class="demo_table">
        Total
      </td>
      <td class="demo_table">
        529
      </td>
      <td class="demo_table">
        535
      </td>
    </tr>
    <tr>
      <td class="demo_table">
        True Positive
      </td>
      <td class="demo_table">
        170 (32.14%)
      </td>
      <td class="demo_table">
        106 (19.81%)
      </td>
    </tr>
    <tr>
      <td class="demo_table">
        False Negative
      </td>
      <td class="demo_table">
        21 (3.97%)
      </td>
      <td class="demo_table">
        18 (3.36%)
      </td>
    </tr>
    <tr>
      <td class="demo_table">
        False Positive
      </td>
      <td class="demo_table">
        1 (0.19%)
      </td>
      <td class="demo_table">
        0 (0.00%)
      </td>
    </tr>
    <tr>
      <td class="demo_table">
        True Negative
      </td>
      <td class="demo_table">
        337 (63,71%)
      </td>
      <td class="demo_table">
        411 (76,82%)
      </td>
    </tr>
    <tr>
      <td class="demo_table">
        sensitivity - SN (95%CI)
      </td>
      <td class="demo_table">
        89.0% (89.0% - 93.1%)
      </td>
      <td class="demo_table">
        85.5% (78.0% - 91.2%)
      </td>
    </tr>
    <tr>
      <td class="demo_table">
        specificity - SP (95%CI)
      </td>
      <td class="demo_table">
        99.7% (98.4% - 100%)
      </td>
      <td class="demo_table">
        100% (99.1% - 100%)
      </td>
    </tr>
    <tr>
      <td class="demo_table">
        positive predict value - PPV (95%CI)
      </td>
      <td class="demo_table">
        99.4% (96.8% - 100%)
      </td>
      <td class="demo_table">
        100% (96.6% - 100%)
      </td>
    </tr>
    <tr>
      <td class="demo_table">
        negative predict value - NPV (95%CI)
      </td>
      <td class="demo_table">
        94.1% (91.2% - 96.3%)
      </td>
      <td class="demo_table">
        95.8% (93.4% - 97.5%)
      </td>
    </tr>
  </table>
  <p>*Obs1: "Sick μ" and "Healthy μ" were inverted because the model expects "Sick μ" to be greater than "Healthy μ", witch was not the case for the measurements from the journal, but this don't impact the analysis. <br>
    *Obs2: The values were scaled down 10x to fit in the range [0:100], but this don't impact the analysis either.</p>
  <p>"Standard Q" and "Panbio" tests data source: <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0248921">Diagnostic accuracy of two commercial SARS-CoV-2 antigen-detecting rapid tests at the point of care in community-based testing centers</a></p>
  <hr>
  <p>If you know more about the subject or have more real data from disease tests and want to share, please contact me. Any contribuition is welcome, preferebly via pull request, creating an <a href="https://github.com/lmkawakami/misc-notebooks/issues">issue on this repo</a> or via email</p>
  <p style="text-align: center;">Author: Lincoln Makoto Kawakami</p>
</body>
<script src="./normalDistr.js"></script>
<script src="./normalDistPlot.js"></script>
<script src="./confusionMatrixPlot.js"></script>
<script src="./rocPlot.js"></script>
<script src="./treeMapPlot.js"></script>
<script src="./binding.js"></script>
<script src="./main.js"></script>

</html>